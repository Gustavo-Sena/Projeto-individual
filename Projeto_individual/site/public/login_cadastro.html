<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>Document</title>
</head>

<body>
    <div class="container">
        <div class="content first-content">
            <div class="first-column">
                <h2 class="title-primary">ENTRAR</h2>
                <p class="description-primary">Para continuar conectado com a gente</p>
                <p class="description-primary">Por favor entre com as suas informações pessoais</p>
                <button id="btn_entrar" class="btn btn-primary">ENTRAR</button>
            </div>
            <div class="second-column">
                <h2 class="title-second">CRIAR CONTA</h2>
                <div class="social-media">
                    <ul class="list-social-media">
                        <a class="link-social-media" href="#">
                            <li class="item-social-media">
                                <i class="fa-brands fa-facebook"></i>
                            </li>
                        </a>
                        <a class="link-social-media" href="#">
                            <li class="item-social-media">
                                <i class="fa-brands fa-google"></i>
                            </li>
                        </a>
                        <a class="link-social-media" href="#">
                            <li class="item-social-media">
                                <i class="fa-brands fa-instagram"></i>
                            </li>
                        </a>
                    </ul>
                </div>
                <p class="description description-second">Cadastre os seus dados</p>
                <form class="form" onsubmit="return false">
                    <label class="label-input" for="">
                        <i class="fa-solid fa-user icon-modify"></i>
                        <input type="text" placeholder="nome" id="nome_input">
                    </label>
                    <label class="label-input" for="">
                        <i class="fa-solid fa-user icon-modify"></i>
                        <input type="text" placeholder="sobrenome" id="sobrenome_input">
                    </label>
                    <label class="label-input" for="">
                        <i class="fa-regular fa-id-card icon-modify"></i>
                        <input type="number" placeholder="cpf" id="cpf_input">
                    </label>
                    <label class="label-input" for="">
                        <i class="fa-regular fa-id-card icon-modify"></i>
                        <input type="text" placeholder="RG" id="rg_input">
                    </label>
                    <label class="label-input" for="">
                        <i class="fa-solid fa-envelope icon-modify"></i>
                        <input type="text" placeholder="email" id="email_input">
                    </label>
                    <label class="label-input" for="">
                        <i class="fa-solid fa-lock icon-modify"></i>
                        <input type="password" placeholder="senha" id="senha_input">
                    </label>
                    <label class="label-input" for="">
                        <i class="fa-solid fa-lock icon-modify"></i>
                        <input type="password" placeholder="confirmar senha" id="confirmacao_senha_input">
                    </label>

                    <button onclick="cadastrar()" class="btn btn-second">CADASTRAR</button>
                </form>
            </div>
        </div>
        <div class="content second-content">
            <div class="first-column">
                <h2 class="title title-primary">Olá, amigo!</h2>
                <p class="description description-primary">Entre com os seus dados pessoais</p>
                <p class="description description-primary">e comece a sua jornada atômica com a gente</p>
                <button id="btn_cadastrar" class="btn btn-primary">CADASTRAR</button>
            </div>
            <div class="second-column">
                <h2 class="title title-second">Entre na sua conta</h2>
                <div class="social-media">
                    <ul class="list-social-media">
                        <a class="link-social-media" href="#">
                            <li class="item-social-media">
                                <i class="fa-brands fa-facebook"></i>
                            </li>
                        </a>
                        <a class="link-social-media" href="#">
                            <li class="item-social-media">
                                <i class="fa-brands fa-google"></i>
                            </li>
                        </a>
                        <a class="link-social-media" href="#">
                            <li class="item-social-media">
                                <i class="fa-brands fa-instagram"></i>
                            </li>
                        </a>
                    </ul>
                </div>
                <p class="description description-second">Ou use o seu email</p>
                <form onsubmit="return false" class="form">
                    <label class="label-input" for="">
                        <i class="fa-solid fa-envelope icon-modify"></i>
                        <input type="text" placeholder="email" id="ipt_email">
                    </label>
                    <label class="label-input" for="">
                        <i class="fa-solid fa-lock icon-modify"></i>
                        <input type="password" placeholder="senha" id="ipt_senha_final">
                    </label>

                    <button onclick="entrar()" class="btn btn-second">ENTRAR</button>
                </form>
            </div>
        </div>
    </div>

</body>

</html>
<script>
    var btn_entrar = document.querySelector("#btn_entrar");

    var btn_cadastrar = document.querySelector("#btn_cadastrar");

    var body = document.querySelector("body");

    btn_entrar.addEventListener("click", function () {
        body.className = "ENTRAR-js";
    });

    btn_cadastrar.addEventListener("click", function () {
        body.className = "CADASTRAR-js"
    })

    function cadastrar() {
        var senha = ipt_senha.value
        var conf_senha = ipt_conf_senha.value

        if (senha == conf_senha) {
            alert("TUDO CERTO!")
        }
        else {
            alert(`A confirmação da senha está diferente da senha inicial`)
        }

    }

    function cadastrar() {

        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo
        var emailVar = email_input.value;
        var senhaVar = senha_input.value;
        var confirmacaoSenhaVar = confirmacao_senha_input.value;
        var nomeVar = nome_input.value;
        var sobrenomeVar = sobrenome_input.value;
        var cpfVar = cpf_input.value;
        var rgVar = rg_input.value;

        if (nomeVar == "" || sobrenomeVar == "" || cpfVar == "" || rgVar == "" || emailVar == "" || senhaVar == "" || confirmacaoSenhaVar == "") {
            alert("CAMPOS VAZIOS")
        }

        else {  

            // Enviando o valor da nova input
            fetch("/usuarios/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    emailServer: emailVar,
                    senhaServer: senhaVar
                })
            }).then(function (resposta) {
                if (resposta.ok) {
                    
                    resposta.json()
                        .then((function (dados_inseridos) {
                            console.log("adsjklajdlk")
                            console.log(dados_inseridos)
                            console.log("Id do usuário inserido: ", dados_inseridos.insertId)
                            var idUser = dados_inseridos.insertId;
    
                            // Enviando o valor da nova input
                            fetch("/usuarios/cadastrar2", {
                                method: "POST",
                                headers: {
                                    "Content-Type": "application/json"
                                },
                                body: JSON.stringify({
                                    nomeServer: nomeVar,
                                    sobrenomeServer: sobrenomeVar,
                                    cpfServer: cpfVar,
                                    rgServer: rgVar,
                                    idUserServer: idUser,
                                })
                            }).then(function (resposta2) {
    
                                console.log("resposta: ", resposta2);
    
                                if (resposta2.ok) {
                                 
    
                                } else {
                                    throw ("Houve um erro ao tentar realizar o cadastro!");
                                }
                            }).catch(function (resposta) {
                                console.log(`#ERRO: ${resposta}`);
                            });
    
                        }))
                } else {
                    throw ("Houve um erro ao cadastrar")
                }
            }).catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });

            return false;
        }
    }

    function entrar() {
        var emailVar = ipt_email.value;
        var senhaVar = ipt_senha_final.value;

        if (emailVar == "" || senhaVar == "") {
            return false;
        }

        console.log("FORM LOGIN: ", emailVar);
        console.log("FORM SENHA: ", senhaVar);

        fetch("/usuarios/autenticar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                emailServer: emailVar,
                senhaServer: senhaVar
            })
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO entrar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    sessionStorage.EMAIL_USUARIO = json.email;
                    sessionStorage.NOME_USUARIO = json.nome;
                    sessionStorage.ID_USUARIO = json.idUsuario;

                    window.location = "./Dashboard/dashboard.html";

                });

            } else {

                console.log("Houve um erro ao tentar realizar o login!");

                resposta.text().then(texto => {
                    console.error(texto);
                    finalizarAguardar(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
    }

</script>